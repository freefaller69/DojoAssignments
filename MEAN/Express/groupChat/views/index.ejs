<!DOCTYPE html>
<html lang="en">
<head>

  <!-- Basic Page Needs
  –––––––––––––––––––––––––––––––––––––––––––––––––– -->
  <meta charset="utf-8">
  <title>Group Chat</title>
  <meta name="description" content="">
  <meta name="author" content="">

  <!-- Mobile Specific Metas
  –––––––––––––––––––––––––––––––––––––––––––––––––– -->
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- FONT
  –––––––––––––––––––––––––––––––––––––––––––––––––– -->
  <link href="//fonts.googleapis.com/css?family=Raleway:400,300,600" rel="stylesheet" type="text/css">

  <!-- CSS
  –––––––––––––––––––––––––––––––––––––––––––––––––– -->
  <link rel="stylesheet" href="/css/normalize.css">
  <link rel="stylesheet" href="/css/skeleton.css">
  <link rel="stylesheet" href="/css/style.css">

  <!-- Scripts
  –––––––––––––––––––––––––––––––––––––––––––––––––– -->
  <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
  <script type ="text/javascript" src="/socket.io/socket.io.js"></script>
  <script type ="text/javascript">
  $(document).ready(function (){
      // triggers connection event in server!
      var socket = io.connect();
      var user, txt;
      user = prompt("Enter a username");
      if (user == null || user == ""){
        user = "Anonymous";
      }
      txt = "Current user: " + user;
      $('#current_user').text(txt);
      // submit to the server using emit
      $('#send').on('click', function(e){
        e.preventDefault();
        socket.emit("send_text", {
          user: user,
          message: $('#chatInput').val()
        });
        return false;
        });
        // Add new message to chat board
        socket.on("new_message", function (message){
            $('#messages').append($('<li>').text(message.user + ": " + message.message));
            $('#chatInput').val('');
        });
        socket.on("new_user", function (chat_history){
          chat_history.forEach(function(chat_history){
              $('#messages').append($('<li>').text(chat_history.user + ": " + chat_history.message));
            $('#chatInput').focus();
          });
        });

        socket.emit("userJoin");
    });
  </script>

</head>
<body>

  <!-- Primary Page Layout
  –––––––––––––––––––––––––––––––––––––––––––––––––– -->
  <div class="container">
    <div class="row">
      <div class="nine columns">
        <h1>Group Chat</h1>
        <p id="current_user"></p>

        <div id="chatBoard">
          <ul id="messages"></ul>
        </div>
        <div id="chatForm">
          <form action="">
            <input type="text" id="chatInput" name="chatInput">
            <button id="send">Send</button>
          </form>
        </div>
      </div>
    </div>
  </div>

<!-- End Document
  –––––––––––––––––––––––––––––––––––––––––––––––––– -->
</body>
</html>
